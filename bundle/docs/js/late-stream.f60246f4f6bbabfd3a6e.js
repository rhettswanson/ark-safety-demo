/*! For license information please see late-stream.f60246f4f6bbabfd3a6e.js.LICENSE.txt */
"use strict";(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[276],{73927:(e,t,n)=>{n.d(t,{h:()=>a});var r=n(89103);class a extends r.QB{constructor(e,t){super(),this.width=e,this.height=t}}},12850:(e,t,n)=>{n.r(t),n.d(t,{default:()=>u});var r=n(15564),a=n(90082),i=n(32484),o=n(71687);const{TEXTURE_SETTINGS:l,clearRaycastHits:s}=i.yJ,u=async function(e){const t=await e.getModuleBySymbol(a.ZF),n=await e.getModuleBySymbol(o.GR),i=t.addPanel(r.F.TITLE,r.F.HOTKEYS,{width:350});await t.loadPromise.then(()=>{const e="meshtextures";[{panel:i,header:e,setting:"disableTextureStreamBelowLod",initialValue:()=>-1,onChange:e=>{e>-1&&n.textureQualityMap.limitStreamingBelow(e)},urlParam:!0,rangePrecision:0,range:[-1,7]},{panel:i,header:e,setting:"textureStreamPause",initialValue:()=>l.debugPauseTexStream,onChange:e=>{l.debugPauseTexStream=e},urlParam:!0},{panel:i,header:e,setting:"textureStreamRaycastHits",initialValue:()=>l.debugLOD,onChange:e=>{l.debugLOD=e,e||s()},urlParam:!0},{panel:i,header:e,setting:"debugRTTQuality",initialValue:()=>l.debugRttQuality,onChange:e=>{l.debugRttQuality=e,e||n.setMeshOverlay({})},urlParam:!0},{panel:i,header:e,setting:"debugRTTScores",initialValue:()=>l.debugRttScores,onChange:e=>{l.debugRttScores=e,e||n.setMeshOverlay({})},urlParam:!0}].forEach(e=>t.registerMenuEntry(e))})}},86465:(e,t,n)=>{n.r(t),n.d(t,{default:()=>m});var r=n(68909),a=n(84440),i=n(25316),o=n(90082),l=n(26072),s=n(32502),u=n(47299),d=n(50839),g=n(39034),c=n(2593),h=n(71687);async function m(e){const t=await e.getModuleBySymbol(h.GR),[n,m,f]=await Promise.all([e.market.waitForData(i.o),e.getModuleBySymbol(o.ZF),e.getModuleBySymbol(h.UN)]);await m.loadPromise.then(()=>{m.registerButton("Mesh","Toggle visible",()=>{t.meshes.forEach(e=>{e.modelMesh.visible=!e.modelMesh.visible})}),m.registerButton("Mesh","Toggle UV debug",()=>{t.meshes.forEach(e=>{const n=e.renderer.chunkRenderingModeOverride?null:s.f.UV;t.setChunkRenderingMode(n)})}),m.registerButton("Mesh","Toggle depth",()=>{t.meshes.forEach(e=>{const n=e.renderer.chunkRenderingModeOverride?null:s.f.Depth;t.setChunkRenderingMode(n)})}),m.registerButton("Mesh","Toggle transparent",()=>{t.meshes.forEach(e=>{const n=e.renderer.chunkRenderingModeOverride?null:s.f.Transparent;t.setChunkRenderingMode(n)})}),m.registerButton("Mesh","Toggle wireframe",()=>{t.meshes.forEach(e=>{const n=e.renderer.chunkRenderingModeOverride?null:s.f.Wireframe;t.setChunkRenderingMode(n)})});let e=!0===Boolean(new URLSearchParams(window.location.search).get("flat"));const i=()=>{t.meshes.forEach(t=>{t.modelMesh instanceof g.f&&t.modelMesh.notifyOnChunksLoaded(t=>{for(const n of t)n.setFlatShading(e)});for(const n of t.modelMesh.chunks)n.setFlatShading(e)})};i(),m.registerButton("Mesh","Toggle flat shading",()=>{e=!e,i()});const o=(()=>{let e=!1;return(n,i)=>{const o=new r.Vector4(1,1,1,0);var l;e=!e,l=n||e,t.meshes.forEach(e=>{for(const t of e.modelMesh.chunks){const e=i?100*t.id:100*t.meshSubgroup,n=l?(0,a.Zd)(.5,e):o;t.setColorOverlay(n)}})}})();m.registerButton("Mesh","Highlight Rooms",o),m.registerButton("Mesh","Highlight Chunks",()=>o(!0,!0)),n.onPropertyChanged(u.Vp,e=>{t.meshes.forEach(t=>{const n=f.getFullBounds();for(const r of t.modelMesh.chunks)r.setMaterialsUniform({floorTrimHeight:1-e/100,floorHeightMin:n.min.y,floorHeightMax:n.max.y},!0)})});const h=(e,t,r,a,i)=>{m.registerSetting(e,t,r,!0,l.u.NONE,i),n.onPropertyChanged(t,a)};h("Wireframe",u._Z,!1,e=>{t.meshes.forEach(t=>{for(const n of t.modelMesh.chunks)n.setWireframe(e)})});const y={[d.d.Wireframe]:{Wireframe:["thickness","wireframeOpacity","stroke","fillEnabled","fill","insideAltColor","dualStroke","secondThickness"],"Wireframe Dashes":["dashEnabled","dashLength","dashAnimate","dashOverlap"],"Wireframe Advanced":["squeeze","squeezeMin","squeezeMax"]}};for(const e in y){const n=c.fu.uniforms[e];for(const r in y[e])for(const a of y[e][r])h(r,a,n[a].value,e=>{t.meshes.forEach(t=>{for(const n of t.modelMesh.chunks)n.setMaterialsUniform({[a]:e})})},n[a].range)}})}},8072:(e,t,n)=>{n.r(t),n.d(t,{default:()=>L,tiledMeshDebugMenu:()=>P});var r=n(68909),a=n(90082),i=n(3066);function o(e,t=16){let n;const r=(0,i.Sh)(()=>n=window.setInterval(()=>e(),t),()=>{n&&clearInterval(n)});return r.cancel(),r}var l=n(244),s=n(24241),u=n(75778),d=n(71687),g=n(48539),c=n(84440),h=n(25712),m=n(32484),f=n(47299),y=n(15564);const p=new s.Vy("tiled-mesh"),{TILEDMESH_SETTINGS:M}=m.yJ,x={hideMenu:"1"!==(0,u.P3)("dmenu","0"),debug:"1"===(0,u.P3)("debugTiles","0")||"1"===(0,u.P3)("debug-tiles","0"),statsTiles:!1,statsTileset:!0,statsTextures:!0,statsTextureStream:!0};let b=null;function T(e,t,n){b||(b=document.createElement("div"),b.style.color="#FFFFFF",b.style.fontFamily="Roboto",b.style.fontWeight="300",b.style.fontSize="12px",b.style.position="absolute",b.style.top="85px",b.style.width="500px",b.style.pointerEvents="none",b.style.whiteSpace="pre",b.style.zIndex="99999",b.style.textShadow="0 0 1px black, 0 0 1px black, 0 0 1px black, 0 0 1px black",document.body.appendChild(b));let r="\n\n";r+=function(e){const t=e.threeRenderer.info;return`three:\n  drawCalls: ${t.render.calls}\n  geometries: ${t.memory.geometries}\n  textures: ${t.memory.textures}\n  triangles: ${t.render.triangles}\n  memory allocated (megs): ${Math.floor(e.estimatedGPUMemoryAllocated()/2**20)}`}(e),r+=x.statsTextureStream?function(e){const t=`\ntextureStreaming:\n  downloadingTiles: ${e.downloadingTiles} / ${e.totalTiles}\n  downloadingTextures: ${e.loadingTextures}\n`,n="  downloaded:\n"+Object.keys(e.totalTextures).map(t=>`    ${t}: ${e.totalTextures[t]} `).join("\n")+"\n";return t+n}(n):"",t.forEach((e,t)=>{const n=e.modelMesh;r+=`\n\n<mesh: id:${t}>`,r+=x.statsTileset?function(e,t){var n,r,a;const i=e.tilesRenderer,o=Object.values(null!==(n=i.tileSets)&&void 0!==n?n:[])[0];return`\n  tileset: preset: ${null===(r=null==o?void 0:o.asset.extras)||void 0===r?void 0:r.preset}, depth: ${null===(a=null==o?void 0:o.asset.extras)||void 0===a?void 0:a.depth}, version: ${null==o?void 0:o.asset.tilesetVersion}\n  view: errorTarget: ${t.settings.errorTarget}, maxLOD: ${t.settings.maxLOD}, detail: '${t.detail}'\n`}(n.tileLoader,n):"",r+=x.statsTiles?function(e){const t=e.tilesRenderer,n=t.visibleTiles,r={};n.forEach(e=>{var t;const n=`lod${null===(t=e.extras)||void 0===t?void 0:t.level}`,a=r[n]||0;r[n]=a+1});const{stats:a,downloadQueue:i,parseQueue:o,lruCache:l}=t,{active:s,downloading:u,inFrustum:d,parsing:g,used:c,visible:h}=a,m=`  tiles:\n    tiles in frustum: ${d}\n    visible: ${h}`+Object.keys(r).sort().map(e=>`\n     ${e} tiles: ${r[e]||0}`).join()+`\n    downloading gltf: ${u}\n    parsing gltf: ${g}\n    active: ${s}\n    used: ${c}\n    queues:\n      download: ${i.currJobs} running, ${i.items.length} waiting\n      parse: ${o.currJobs} running, ${o.items.length} waiting\n    lruCache: ${l.itemSet.size}\n`;return m}(n.tileLoader):"",r+=`</mesh: id:${t}>`}),b.textContent=r}function v(e,t,n,a,i,l){S&&(e.forEach((e,n)=>{E.has(e.modelMesh)||(E.add(e.modelMesh),w.push(...function(e,t,n,a){const i=[{panel:e,header:t.tile+": "+n,setting:"maxLOD: "+n,initialValue:()=>a.settings.maxLOD,onChange:e=>{a.settings.maxLOD=e},range:[0,4],rangePrecision:0},{panel:e,header:t.tile+": "+n,setting:"nonMeshMaxLOD: "+n,initialValue:()=>a.settings.nonMeshMaxLOD,onChange:e=>{a.settings.nonMeshMaxLOD=e},range:[0,4],rangePrecision:0},{panel:e,header:t.tile+": "+n,setting:"minLOD: "+n,initialValue:()=>a.settings.minLOD,onChange:e=>{a.settings.minLOD=e},range:[0,4],rangePrecision:0},{panel:e,header:t.tile+": "+n,setting:"errorTarget:"+n,initialValue:()=>a.settings.errorTarget,onChange:e=>{a.settings.errorTarget=e},range:[0,20],rangePrecision:1,urlParam:!0},{panel:e,header:t.tile+": "+n,setting:"disableTileUpdates:"+n,initialValue:()=>a.settings.disableTileUpdates,onChange:e=>{a.settings.disableTileUpdates=e}},{panel:e,header:t.tile+": "+n,setting:"disposeModel: "+n,initialValue:()=>a.settings.disposeModel,onChange:e=>{a.settings.disposeModel=e}},{panel:e,header:t.tile+": "+n,setting:"pos on z axis: "+n,initialValue:()=>0,onChange:e=>{a.position.copy(new r.Vector3(0,0,e)),a.updateMatrixWorld(!0)},range:[-100,100],rangePrecision:0}];return i}(t,a,n,e.modelMesh)),w.push(...function(e,t,n,r,a,i){const l=r.tileLoader,s=V(l,i,(e,t)=>e.setWireframe(t)),u=function(e,t){const n={scale:1},r=V(e,t,(t,r)=>{if(!t)return;const a=e.container.tilesByChunkId.get(t.id),i=(null==a?void 0:a.__error)||1e-4,o=t.lod!==M.maxLOD&&i>M.errorTarget?1:.5,l=Math.max(0,Math.min(1,1-n.scale/i)),s=r?B(t.lod,l,o):null;t.setColorOverlay(s)}),a=o(()=>r.colorize(e.container.chunks));return{toggle:e=>{e?a.renew():a.cancel(),r.toggle(e)},colorize:r.colorize,subscription:a,config:n}}(l,i),d=V(l,i,(e,t)=>{e.setColorOverlay(t?B(e.lod,1,.5):null)}),g=V(l,i,(e,t)=>{e.setColorOverlay(t?(0,c.Zd)(.5,e.id||0):null)}),m=V(l,i,(e,t)=>{var n;const r=l.container.tilesByChunkId.get(e.id);e.setColorOverlay(t?(0,c.Zd)(.5,(0,h.s5)((null===(n=null==r?void 0:r.content)||void 0===n?void 0:n.uri)||"missing")||0):null)}),f=V(l,i,(e,t)=>{e.setColorOverlay(t?(0,c.Zd)(.5,(e.meshGroup<<16)+e.meshSubgroup||0):null)}),y=V(l,i,(e,t)=>{e.setColorOverlay(t?(0,c.Zd)(.5,e.meshSubgroup||0):null)}),x=V(l,i,(e,t)=>{e.setColorOverlay(t?(0,c.Zd)(.5,e.meshGroup||0):null)}),b=V(l,i,(e,t)=>{e.setColorOverlay(t?(0,c.Zd)(.5,(0,h.s5)(e.textureName)||0):null)}),T=V(l,i,(e,t)=>{const n=l.container.tilesByChunkId.get(e.id);e.setColorOverlay(t?(0,c.Zd)(.5,(null==n?void 0:n.geometricError)||0):null)}),v=a.slots,w=r.textureQualityMap,E=V(l,i,(e,t)=>{const n=v.find(t=>t.textureName===e.textureName);if(n){const r=n.loading?1:n.quality>w.min(e.lod)?.7:.3,a=w.maxTexelSize/w.get(n.quality).texelSize;e.setColorOverlay(t?B(e.lod,a,r):null)}}),S=o(()=>E.colorize(l.container.chunks));let C="none";const P={none:void 0,byError:u,byGeometricError:T,byTile:m,bySubgroup:y,byMeshgroup:x,bySubAndMeshgroup:f,byTexture:b,byStreamedTextures:{subscription:S,toggle:e=>{e?S.renew():S.cancel(),e&&p.info("colorize=byStreamedTextures solid color: loading, dark color: streamed, light color: basis"),E.toggle(e)}},byChunk:g,byLod:d},O=[{panel:e,header:`${t.viz}: ${n}`,setting:"disableTileUpdates:"+n,initialValue:()=>r.settings.disableTileUpdates,onChange:e=>{r.settings.disableTileUpdates=e},urlParam:!0},{panel:e,header:`${t.viz}: ${n}`,setting:"wireframe:"+n,initialValue:()=>!1,onChange:s.toggle,urlParam:!0},{panel:e,header:`${t.viz}: ${n}`,setting:"colorize:"+n,initialValue:()=>"none",onChange:e=>{var t,n;null===(t=P[C])||void 0===t||t.toggle(!1),null===(n=P[e])||void 0===n||n.toggle(!0),C=e},options:Object.keys(P),urlParam:!0},{panel:e,header:`${t.viz}: ${n}`,setting:"colorizeByErrorScale:"+n,initialValue:()=>1,onChange:e=>{u.config.scale=e},range:[0,6],rangePrecision:3,urlParam:!0}];return O}(t,a,n,e.modelMesh,i,l)))}),w.length&&(w.forEach(e=>n.registerMenuEntry(e)),w.length=0))}const w=[],E=new Set;let S=!1,C=null;async function P(e){if(!x.debug)return;const t=await e.getModuleBySymbol(a.ZF),n=await e.getModuleBySymbol(d.mL),r=await e.getModuleBySymbol(d.M7),i=r.getScene(),o=await e.getModuleBySymbol(d.GR);await o.firstMeshLoadPromise,await(0,g.cb)(100);const l=o.meshes,s=o.meshTextureLoader,u=t.tryGetProperty(f.sz,!1),c=t.addPanel(y.F.TITLE,y.F.HOTKEYS,{width:350}),h={viz:"visualize",stats:"stats",tile:"tileset",log:"log"};function m(){C||(C=setInterval(()=>{T(r,l,s),v(l,c,t,h,s,e)},150))}const b=[{panel:c,header:h.stats,setting:"tilesetStatsOverlay",initialValue:()=>x.statsTileset,onChange:e=>{x.statsTileset=e,e&&m()},urlParam:!0},{panel:c,header:h.stats,setting:"tileStatsOverlay",initialValue:()=>x.statsTiles,onChange:e=>{x.statsTiles=e,e&&m()},urlParam:!0},{panel:c,header:h.stats,setting:"textureStatsOverlay",initialValue:()=>x.statsTextures,onChange:e=>{x.statsTextures=e,e&&m()},urlParam:!0},{panel:c,header:h.stats,setting:"textureStreamingOverlay",initialValue:()=>x.statsTextureStream,onChange:e=>{x.statsTextureStream=e,e&&m()},urlParam:!0}],w=[{panel:c,header:h.log,buttonName:"Log: App State",callback:()=>{p.warn(l),p.warn(n),p.warn(i),p.warn(t)}}];u&&(x.hideMenu||await(0,g.cb)(1e3).then(()=>{t.getSettingsGui().loadGuiPackage().then(()=>{t.getSettingsGui().toggle(t.getMainPanelId()),t.getSettingsGui().toggle(t.getMainPanelId())})}),await(0,g.cb)(16),S||(await(0,g.cb)(16),S=!0,function(e,t,n,r){const a=[{panel:e,header:t.tile,setting:"smallMeshThreshold",initialValue:()=>M.smallMeshThreshold,onChange:e=>{M.smallMeshThreshold=e,r.forEach(t=>{t.modelMesh.settings.smallMeshThreshold=e})},range:[0,100],rangePrecision:1,urlParam:!0},{panel:e,header:t.tile,setting:"smallMeshErrorMultiplier",initialValue:()=>M.smallMeshErrorMultiplier,onChange:e=>{M.smallMeshErrorMultiplier=e,r.forEach(t=>{t.modelMesh.settings.smallMeshErrorMultiplier=e})},range:[.01,2],rangePrecision:2,urlParam:!0},{panel:e,header:t.tile,setting:"displayActiveTiles",initialValue:()=>M.displayActiveTiles,onChange:e=>{M.displayActiveTiles=e,r.forEach(t=>{t.modelMesh.settings.displayActiveTiles=e})},urlParam:!0},{panel:e,header:t.tile,setting:"loadSiblings",initialValue:()=>M.loadSiblings,onChange:e=>{M.loadSiblings=e,r.forEach(t=>{t.modelMesh.settings.loadSiblings=e})},urlParam:!0},{panel:e,header:t.tile,setting:"autoDisableRendererCulling",initialValue:()=>M.autoDisableRendererCulling,onChange:e=>{M.autoDisableRendererCulling=e,r.forEach(t=>{t.modelMesh.settings.autoDisableRendererCulling=e})},urlParam:!0},{panel:e,header:t.tile,setting:"stopAtEmptyTiles",initialValue:()=>M.stopAtEmptyTiles,onChange:e=>{M.stopAtEmptyTiles=e,r.forEach(t=>{t.modelMesh.settings.stopAtEmptyTiles=e})},urlParam:!0},{panel:e,header:t.tile,setting:"limitMemoryUsage",initialValue:()=>M.limitMemoryUsage,onChange:e=>{M.limitMemoryUsage=e,r.forEach(t=>{t.modelMesh.settings.limitMemoryUsage=e})},urlParam:!0},{panel:e,header:t.tile,setting:"allocatedMegsBeforeLimitingLod",initialValue:()=>M.allocatedMegsBeforeLimitingLod,onChange:e=>{M.allocatedMegsBeforeLimitingLod=e,r.forEach(t=>{t.modelMesh.settings.allocatedMegsBeforeLimitingLod=e})},urlParam:!0,range:[100,1e3]},{panel:e,header:t.tile,setting:"lruMinExtraTiles",initialValue:()=>M.lruMinExtraTiles,onChange:e=>{M.lruMinExtraTiles=e,r.forEach(t=>{t.modelMesh.settings.lruMinExtraTiles=e})},urlParam:!0,range:[0,2e3]},{panel:e,header:t.tile,setting:"lruMaxTiles",initialValue:()=>M.lruMaxTiles,onChange:e=>{M.lruMaxTiles=e,r.forEach(t=>{t.modelMesh.settings.lruMaxTiles=e})},urlParam:!0,range:[0,2e3]},{panel:e,header:t.tile,setting:"lruUnloadPercent",initialValue:()=>M.lruUnloadPercent,onChange:e=>{M.lruUnloadPercent=e,r.forEach(t=>{t.modelMesh.settings.lruUnloadPercent=e})},urlParam:!0,range:[0,1]},{panel:e,header:"Priority",setting:"errorMultiplierRaycastOcclusion",initialValue:()=>M.errorMultiplierRaycastOcclusion,onChange:e=>{M.errorMultiplierRaycastOcclusion=e,r.forEach(t=>{t.modelMesh.settings.errorMultiplierRaycastOcclusion=e})},range:[.001,1],rangePrecision:2},{panel:e,header:"Priority",setting:"errorMultiplierHiddenFloors",initialValue:()=>M.errorMultiplierHiddenFloors,onChange:e=>{M.errorMultiplierHiddenFloors=e,r.forEach(t=>{t.modelMesh.settings.errorMultiplierHiddenFloors=e})},range:[.001,1],rangePrecision:2}];return a}(c,h,0,l).forEach(e=>t.registerMenuEntry(e)),b.forEach(e=>t.registerMenuEntry(e)),w.forEach(e=>t.registerMenuButton(e))))}function V(e,t,n){let r=!1;const a=e=>{t.after(l.R.End).then(()=>{e.forEach(e=>{e&&n(e,r)})})},i=e.notifyOnChunksLoaded(a);return i.cancel(),{toggle:t=>{t?i.renew():i.cancel(),t!==r&&(r=t,a([...e.container.chunks]))},colorize:a,subscription:i}}const O={0:new r.Vector4(1,0,0,1),1:new r.Vector4(0,1,0,1),2:new r.Vector4(0,0,1,1),3:new r.Vector4(1,1,1,1),4:new r.Vector4(1,0,1,1),5:new r.Vector4(0,1,1,1),6:new r.Vector4(1,1,0,1),7:new r.Vector4(0,0,0,1)};function B(e,t,n){var a,i;const o=null!==(i=null===(a=O[e])||void 0===a?void 0:a.clone())&&void 0!==i?i:new r.Vector4;return o.multiplyScalar(t),o.setW(n),o}const L=P},15564:(e,t,n)=>{n.d(t,{F:()=>r});const r={TITLE:"streamed-mesh (T)",HOTKEYS:[n(71397).D.T]}},32484:(e,t,n)=>{n.d(t,{yJ:()=>o});var r=n(80112),a=n(47299),i=n(14971);const o={TEXTURE_SETTINGS:a.Ay,TILEDMESH_SETTINGS:r.W,clearRaycastHits:i.Jn}},30443:(e,t,n)=>{n.d(t,{U7:()=>u,UX:()=>s,Wi:()=>g,h0:()=>i,jF:()=>c,nD:()=>h});var r=n(68909),a=n(81662);function i(e){if(0===e.length)throw Error("Can't merge empty list of geometries");if(1===e.length)return e[0];let t=0,n=0,a=0,i=0;const l=new r.Box3;for(const r of e)r.index&&(t+=r.index.count,n+=r.getAttribute("position").count,r.getAttribute("uv")&&(a+=r.getAttribute("uv").count),r.boundingBox&&(l.union(r.boundingBox),i++));const u=new r.BufferGeometry;i!==e.length||l.isEmpty()?u.computeBoundingBox():u.boundingBox=l,l.copy(s(u)),u.boundingSphere=l.getBoundingSphere(new r.Sphere);const d=o(new Float32Array(3*n),"position",e);u.setAttribute("position",new r.BufferAttribute(d,3));const g=function(e,t){let n=0,r=0;for(const a of t){const t=a.index;for(let a=0;a<t.array.length;a++)e[n+a]=t.array[a]+r;n+=t.array.length,r+=a.getAttribute("position").count}return e}(new Uint32Array(t),e);if(u.setIndex(new r.BufferAttribute(g,1)),a){const t=o(new Float32Array(2*a),"uv",e);u.setAttribute("uv",new r.BufferAttribute(t,2))}return u}function o(e,t,n){let r=0;for(const a of n){const n=a.getAttribute(t);e.set(n.array,r),r+=n.array.length}return e}const l=new r.Box3(a.B1.ZERO,a.B1.UNIT);function s(e){return e.boundingBox||e.computeBoundingBox(),e.boundingBox||l}function u(e,t){let n=1/0;const a=t.clone(),i=new r.Vector3,o=new r.Vector3(1/0,1/0,1/0);let l=-1;const s=new r.Triangle;return function(e,t){var n;const r=null===(n=e.index)||void 0===n?void 0:n.array,a=e.getAttribute("position");if(!a)return;const i=e.groups.length>0?e.groups:[{start:0,count:r?r.length:a.count,materialIndex:0}];let o=0;for(const e of i)for(let n=e.start;n<e.start+e.count;n+=3){let i=n,l=n+1,s=n+2;r&&(i=r[i],l=r[l],s=r[s]),t(a.getX(i),a.getY(i),a.getZ(i),a.getX(l),a.getY(l),a.getZ(l),a.getX(s),a.getY(s),a.getZ(s),o++,e.materialIndex)}}(e,(e,t,r,u,d,g,c,h,m,f)=>{s.a.set(e,t,r),s.b.set(u,d,g),s.c.set(c,h,m),s.closestPointToPoint(a,i);const y=a.distanceToSquared(i);y<n&&(o.copy(i),n=y,l=f)}),{point:o,distance:Math.sqrt(n),faceIndex:l}}const d=new r.PlaneGeometry(1,1);function g(){return d}const c=(e,t)=>{t=t||[];for(let e=0;e<8;e++)t[e]=t[e]||new r.Vector3;return t[0].set(e.min.x,e.min.y,e.min.z),t[1].set(e.min.x,e.max.y,e.min.z),t[2].set(e.max.x,e.max.y,e.min.z),t[3].set(e.max.x,e.min.y,e.min.z),t[4].set(e.min.x,e.min.y,e.max.z),t[5].set(e.min.x,e.max.y,e.max.z),t[6].set(e.max.x,e.max.y,e.max.z),t[7].set(e.max.x,e.min.y,e.max.z),t},h=(()=>{const e=new r.Vector3,t=new r.Vector3;return(n,a,i)=>{a=a||new r.Box3,e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t.set(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE);for(const r of n)i&&r.applyMatrix4(i),e.x=Math.min(e.x,r.x),e.y=Math.min(e.y,r.y),e.z=Math.min(e.z,r.z),t.x=Math.max(t.x,r.x),t.y=Math.max(t.y,r.y),t.z=Math.max(t.z,r.z);return a.min.copy(e),a.max.copy(t),a}})()}}]);