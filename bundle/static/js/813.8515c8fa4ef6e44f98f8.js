/*! For license information please see 813.8515c8fa4ef6e44f98f8.js.LICENSE.txt */
"use strict";(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[813],{20014:(e,t,i)=>{i.d(t,{g:()=>o,l:()=>a});var s=i(92475);class a extends s.E{constructor(e){super(),this.pinchDelta=e}}class o extends s.E{constructor(e,t){super(),this.pinchDelta=e,this.timeSinceLastMove=t}}},44667:(e,t,i)=>{i.d(t,{s:()=>a});var s=i(92475);class a extends s.E{constructor(e,t,i){super(),this.position=e,this.delta=t,this.viewport=i}}},60043:(e,t,i)=>{i.d(t,{k:()=>a});var s=i(49586);class a extends s.T{constructor(e,t,i){super(),this.key=e,this.state=t,this.modifiers=i}}},31285:(e,t,i)=>{i.d(t,{A:()=>a});var s=i(89103);class a extends s.QB{constructor(e){super(),this.zoomLevel=e}}},37813:(e,t,i)=>{i.r(t),i.d(t,{default:()=>b});var s=i(75578),a=i(71687),o=i(44667),n=i(20014),r=i(60043),h=i(71397),d=i(28337),c=i(20599),m=i(12767),l=i(99583),u=i(62372),p=i(3249),w=i(53172),g=i(46771),D=i(74717),y=i(31285),v=i(76318);class b extends s.n{constructor(){super(...arguments),this.name="zoom-controls",this.uhQuality={},this.config={enabled:!0}}async init(e,t){this.config.enabled=!!e.enabled,this.sweepTilingModule=await t.getModuleBySymbol(a.qD),this.config.enabled&&await this.registerControls(t),this.engine=t,this.cameraModule=await t.getModuleBySymbol(a.jh),this.cameraData=await t.market.waitForData(c.M),this.viewmodeData=await t.market.waitForData(l.X),this.sweepData=await t.market.waitForData(u.A),this.bindings.push(t.commandBinder.addBinding(D.EG,async e=>this.zoomBy(e.step)),t.commandBinder.addBinding(D.De,async e=>this.zoomBy(-e.step)),t.commandBinder.addBinding(D.i9,async()=>this.zoomTo(1)),t.commandBinder.addBinding(D.hd,async e=>this.zoomTo(e.value)),t.commandBinder.addBinding(D.BW,async()=>Promise.resolve(this.getMaxZoomAvailable())))}async registerControls(e){e.getModuleBySymbol(a.mL).then(e=>{this.bindings.push(e.registerHandler(o.s,e=>this.zoomByInput(this.scrollToZoomDelta(e)))),this.bindings.push(e.registerHandler(n.l,e=>this.zoomByInput(this.pinchToZoomDelta(e)))),this.bindings.push(e.registerHandler(r.k,e=>this.keyHandler(e)))})}zoomTo(e){const t=this.cameraData.zoom();if(!this.validateViewmode())return t;const{currentSweep:i,currentSweepObject:s}=this.sweepData;if(s&&this.checkTilingZoomLevels(e,s),(e=(0,p.qE)(e,.7,this.getMaxZoom(i)))!==t){const t=(0,w.H)(this.cameraData.baseFovY/e),i=m.Bv.near,s=m.Bv.far;this.cameraModule.updateCameraProjection((new g.k).makePerspectiveFov(t,this.cameraData.aspect(),i,s))}return this.engine.broadcast(new y.A(e)),e}checkTilingZoomLevels(e,t){e>=1.1&&this.zoomedSweep!==t?(this.zoomedSweep=t,this.sweepTilingModule.enableZooming(!0,t.id)?this.uhQuality[t.id]=!0:(this.uhQuality[t.id]=!1,this.zoomedSweep=void 0)):e<1.1&&this.zoomedSweep&&this.zoomedSweep===t&&(this.sweepTilingModule.enableZooming(!1,this.zoomedSweep.id),this.zoomedSweep=void 0)}getMaxZoom(e){return this.uhQuality[null!=e?e:"none"]?3:2}zoomBy(e){const t=this.cameraData.zoom();return this.validateViewmode()?this.zoomTo(t+e):t}validateViewmode(){return this.viewmodeData.isInside()&&this.cameraData.canTransition()}scrollToZoomDelta(e){return.1*-Math.sign(e.delta.y)}pinchToZoomDelta(e){return 1.3*e.pinchDelta}zoomByInput(e){const t=this.cameraData.zoom();if(!this.validateViewmode())return t;const i=this.sweepData.currentSweep,s=(0,p.qE)(t+e,.7,this.getMaxZoom(i));return this.zoomTo(s)}keyHandler(e){if(e.state===d.$.DOWN)switch(e.key){case h.D.PLUSEQUALS:this.zoomByInput(.1);break;case h.D.DASHUNDERSCORE:this.zoomByInput(-.1);break;case h.D.OPENBRACKET:this.zoomTo(1)}}getMaxZoomAvailable(){return this.sweepData.currentSweepObject&&this.sweepData.currentSweepObject.availableResolution(v.MF.ULTRAHIGH)>=v.MF.ULTRAHIGH?3:2}}}}]);