/*! For license information please see encoders.effb12f474a2a4ae27cd.js.LICENSE.txt */
"use strict";(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[780],{34649:(t,e,a)=>{a.r(e),a.d(e,{ArrayBufferDataStream:()=>i,BlobBuffer:()=>r,WebMWriter:()=>n}),a(48287).hp;const i=function(t){this.data=new Uint8Array(t),this.pos=0};i.prototype.seek=function(t){this.pos=t},i.prototype.writeBytes=function(t){for(var e=0;e<t.length;e++)this.data[this.pos++]=t[e]},i.prototype.writeByte=function(t){this.data[this.pos++]=t},i.prototype.writeU8=i.prototype.writeByte,i.prototype.writeU16BE=function(t){this.data[this.pos++]=t>>8,this.data[this.pos++]=t},i.prototype.writeDoubleBE=function(t){for(var e=new Uint8Array(new Float64Array([t]).buffer),a=e.length-1;a>=0;a--)this.writeByte(e[a])},i.prototype.writeFloatBE=function(t){for(var e=new Uint8Array(new Float32Array([t]).buffer),a=e.length-1;a>=0;a--)this.writeByte(e[a])},i.prototype.writeString=function(t){for(var e=0;e<t.length;e++)this.data[this.pos++]=t.charCodeAt(e)},i.prototype.writeEBMLVarIntWidth=function(t,e){switch(e){case 1:this.writeU8(128|t);break;case 2:this.writeU8(64|t>>8),this.writeU8(t);break;case 3:this.writeU8(32|t>>16),this.writeU8(t>>8),this.writeU8(t);break;case 4:this.writeU8(16|t>>24),this.writeU8(t>>16),this.writeU8(t>>8),this.writeU8(t);break;case 5:this.writeU8(8|t/4294967296&7),this.writeU8(t>>24),this.writeU8(t>>16),this.writeU8(t>>8),this.writeU8(t);break;default:throw new RuntimeException("Bad EBML VINT size "+e)}},i.prototype.measureEBMLVarInt=function(t){if(t<127)return 1;if(t<16383)return 2;if(t<2097151)return 3;if(t<268435455)return 4;if(t<34359738367)return 5;throw new RuntimeException("EBML VINT size not supported "+t)},i.prototype.writeEBMLVarInt=function(t){this.writeEBMLVarIntWidth(t,this.measureEBMLVarInt(t))},i.prototype.writeUnsignedIntBE=function(t,e){switch(void 0===e&&(e=this.measureUnsignedInt(t)),e){case 5:this.writeU8(Math.floor(t/4294967296));case 4:this.writeU8(t>>24);case 3:this.writeU8(t>>16);case 2:this.writeU8(t>>8);case 1:this.writeU8(t);break;default:throw new RuntimeException("Bad UINT size "+e)}},i.prototype.measureUnsignedInt=function(t){return t<256?1:t<65536?2:t<1<<24?3:t<4294967296?4:5},i.prototype.getAsDataArray=function(){if(this.pos<this.data.byteLength)return this.data.subarray(0,this.pos);if(this.pos==this.data.byteLength)return this.data;throw"ArrayBufferDataStream's pos lies beyond end of buffer"};const r=function(){var t=[],e=Promise.resolve();function a(t){return new Promise(function(e,a){var i=new FileReader;i.addEventListener("loadend",function(){e(i.result)}),i.readAsArrayBuffer(t)})}function i(t){return new Promise(function(e,i){t instanceof Uint8Array?e(t):t instanceof ArrayBuffer||ArrayBuffer.isView(t)?e(new Uint8Array(t)):t instanceof Blob?e(a(t).then(function(t){return new Uint8Array(t)})):e(a(new Blob([t])).then(function(t){return new Uint8Array(t)}))})}function r(t){var e=t.byteLength||t.length||t.size;if(!Number.isInteger(e))throw"Failed to determine size of element";return e}this.pos=0,this.length=0,this.seek=function(t){if(t<0)throw"Offset may not be negative";if(isNaN(t))throw"Offset may not be NaN";if(t>this.length)throw"Seeking beyond the end of file is not allowed";this.pos=t},this.write=function(a){var n={offset:this.pos,data:a,length:r(a)},s=n.offset>=this.length;this.pos+=n.length,this.length=Math.max(this.length,this.pos),e=e.then(function(){if(!s)for(var e=0;e<t.length;e++){var a=t[e];if(!(n.offset+n.length<=a.offset||n.offset>=a.offset+a.length)){if(n.offset<a.offset||n.offset+n.length>a.offset+a.length)throw new Error("Overwrite crosses blob boundaries");return n.offset==a.offset&&n.length==a.length?void(a.data=n.data):i(a.data).then(function(t){return a.data=t,i(n.data)}).then(function(t){n.data=t,a.data.set(n.data,n.offset-a.offset)})}}t.push(n)})},this.complete=function(a){return e=e.then(function(){for(var e=[],i=0;i<t.length;i++)e.push(t[i].data);return new Blob(e,{type:a})})}},n=function(t){function e(t){var e=t.indexOf("VP8 ");if(-1==e)throw"Failed to identify beginning of keyframe in WebP image";return e+=8,t.substring(e)}function a(t){this.value=t}function n(t){this.value=t}function s(t,e,i){if(Array.isArray(i))for(var r=0;r<i.length;r++)s(t,e,i[r]);else if("string"==typeof i)t.writeString(i);else if(i instanceof Uint8Array)t.writeBytes(i);else{if(!i.id)throw"Bad EBML datatype "+typeof i.data;var o,f,d;if(i.offset=t.pos+e,t.writeUnsignedIntBE(i.id),Array.isArray(i.data))-1===i.size?t.writeByte(255):(o=t.pos,t.writeBytes([0,0,0,0])),f=t.pos,i.dataOffset=f+e,s(t,e,i.data),-1!==i.size&&(d=t.pos,i.size=d-f,t.seek(o),t.writeEBMLVarIntWidth(i.size,4),t.seek(d));else if("string"==typeof i.data)t.writeEBMLVarInt(i.data.length),i.dataOffset=t.pos+e,t.writeString(i.data);else if("number"==typeof i.data)i.size||(i.size=t.measureUnsignedInt(i.data)),t.writeEBMLVarInt(i.size),i.dataOffset=t.pos+e,t.writeUnsignedIntBE(i.data,i.size);else if(i.data instanceof n)t.writeEBMLVarInt(8),i.dataOffset=t.pos+e,t.writeDoubleBE(i.data.value);else if(i.data instanceof a)t.writeEBMLVarInt(4),i.dataOffset=t.pos+e,t.writeFloatBE(i.data.value);else{if(!(i.data instanceof Uint8Array))throw"Bad EBML datatype "+typeof i.data;t.writeEBMLVarInt(i.data.byteLength),i.dataOffset=t.pos+e,t.writeBytes(i.data)}}}var o,f,d,u=!1,h=0,w=0,p=[],c=0,l=0,y={Cues:{id:new Uint8Array([28,83,187,107]),positionEBML:null},SegmentInfo:{id:new Uint8Array([21,73,169,102]),positionEBML:null},Tracks:{id:new Uint8Array([22,84,174,107]),positionEBML:null}},g={id:17545,data:new n(0)},m=[],b=new r(t.fileWriter||t.fd);function B(t){return t-o.dataOffset}function U(){f=function(){var t={id:21420,size:5,data:0},e={id:290298740,data:[]};for(var a in y){var i=y[a];i.positionEBML=Object.create(t),e.data.push({id:19899,data:[{id:21419,data:i.id},i.positionEBML]})}return e}();var t={id:357149030,data:[{id:2807729,data:1e6},{id:19840,data:"webm-writer-js"},{id:22337,data:"webm-writer-js"},g]},e={id:374648427,data:[{id:174,data:[{id:215,data:1},{id:29637,data:1},{id:156,data:0},{id:2274716,data:"und"},{id:134,data:"V_VP8"},{id:2459272,data:"VP8"},{id:131,data:1},{id:224,data:[{id:176,data:h},{id:186,data:w}]}]}]};o={id:408125543,size:-1,data:[f,t,e]};var a=new i(256);s(a,b.pos,[{id:440786851,data:[{id:17030,data:1},{id:17143,data:1},{id:17138,data:4},{id:17139,data:8},{id:17026,data:"webm"},{id:17031,data:2},{id:17029,data:2}]},o]),b.write(a.getAsDataArray()),y.SegmentInfo.positionEBML.data=B(t.offset),y.Tracks.positionEBML.data=B(e.offset),u=!0}function v(t){var e=new i(4);if(!(t.trackNumber>0&&t.trackNumber<127))throw"TrackNumber must be > 0 and < 127";return e.writeEBMLVarInt(t.trackNumber),e.writeU16BE(t.timecode),e.writeByte(128),{id:163,data:[e.getAsDataArray(),t.frame]}}function E(){if(0!=p.length){for(var t=0,e=0;e<p.length;e++)t+=p[e].frame.length;var a,r,n=new i(t+32*p.length),o=function(t){return{id:524531317,data:[{id:231,data:Math.round(t.timecode)}]}}({timecode:Math.round(c)});for(e=0;e<p.length;e++)o.data.push(v(p[e]));s(n,b.pos,o),b.write(n.getAsDataArray()),a=Math.round(c),r=o.offset,m.push({id:187,data:[{id:179,data:a},{id:183,data:[{id:247,data:1},{id:241,data:B(r)}]}]}),p=[],c+=l,l=0}}this.addFrame=function(a,i){u||(h=a.width||0,w=a.height||0,U());var r,n=function(t,e){var a;return!("string"!=typeof(a="string"==typeof t&&/^data:image\/webp/.test(t)?t:t.toDataURL("image/webp",e))||!a.match(/^data:image\/webp;base64,/i))&&window.atob(a.substring(23))}(a,t.quality);if(!n)throw"Couldn't decode WebP frame, does the browser support WebP?";(r={frame:e(n),duration:void 0===i?t.frameDuration:i}).trackNumber=1,r.timecode=Math.round(l),p.push(r),(l+=r.duration)>=5e3&&E()},this.complete=function(){var t,e,a,r;return u||U(),E(),t={id:475249515,data:m},s(e=new i(16+32*m.length),b.pos,t),b.write(e.getAsDataArray()),y.Cues.positionEBML.data=B(t.offset),a=new i(f.size),r=b.pos,s(a,f.dataOffset,f.data),b.seek(f.dataOffset),b.write(a.getAsDataArray()),b.seek(r),function(){var t=new i(8),e=b.pos;t.writeDoubleBE(c),b.seek(g.dataOffset),b.write(t.getAsDataArray()),b.seek(e)}(),b.complete("video/webm")},this.getWrittenSize=function(){return b.length},d={},[{quality:.95,fileWriter:null,fd:null,frameDuration:null,frameRate:null},t||{}].forEach(function(t){for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(d[e]=t[e])}),t=d,function(){if(!t.frameDuration){if(!t.frameRate)throw"Missing required frameDuration or frameRate setting";t.frameDuration=1e3/t.frameRate}}()}}}]);